"""
é—®é¢˜æå–æ¨¡æ¿ - åŒ…å«é—®é¢˜åˆ†æã€é£é™©ç›‘æ§ã€é—®é¢˜åˆ†ç±»ã€ä¼˜å…ˆçº§åˆ¤æ–­ç›¸å…³çš„ LLM æç¤ºè¯

æ¨¡æ¿å˜é‡è¯´æ˜:
- {chat_context}: å¯¹è¯å†…å®¹
- {similar_context}: å†å²ç›¸ä¼¼æ¡ˆä¾‹
- {format_instructions}: JSON æ ¼å¼è¯´æ˜
- {text}: å¾…åˆ†æçš„æ–‡æœ¬
- {taxonomy_version}: åˆ†ç±»ä½“ç³»ç‰ˆæœ¬
- {taxonomy_tree}: åˆ†ç±»æ ‘ç»“æ„
- {labels}: å¯é€‰æ ‡ç­¾åˆ—è¡¨
- {short_labels}: çŸ­æ ‡ç­¾å‚è€ƒ
- {historical_categories}: RAG æ£€ç´¢çš„å†å²ç›¸ä¼¼æ¡ˆä¾‹åˆ†ç±»å‚è€ƒ

ä¼˜å…ˆçº§ä½“ç³»è¯´æ˜:
- éå¸¸ç´§æ€¥ï¼ˆçº¢è‰²ğŸ”´ï¼‰ï¼šç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨ã€å½±å“å…¨éƒ¨ç”¨æˆ·ã€ç”¨æˆ·éå¸¸æ„¤æ€’ã€ä¸šåŠ¡é˜»å¡
- ç´§æ€¥ï¼ˆé»„è‰²ğŸŸ¡ï¼‰ï¼šæ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ã€å½±å“å¤§éƒ¨åˆ†ç”¨æˆ·ã€ç”¨æˆ·ç„¦æ€¥å‚¬ä¿ƒ
- æ™®é€šï¼ˆè“è‰²ğŸ”µï¼‰ï¼šä¸€èˆ¬é—®é¢˜åé¦ˆã€åŠŸèƒ½å¼‚å¸¸ä½†å¯ç»•è¿‡ã€å½±å“éƒ¨åˆ†ç”¨æˆ·
- è¾ƒä½ï¼ˆç°è‰²âšªï¼‰ï¼šæ™®é€šå’¨è¯¢ã€å»ºè®®ç±»ã€å½±å“æå°ã€å·²è§£å†³çš„é—®é¢˜

é—®é¢˜ç±»å‹è¯´æ˜:
- ä½¿ç”¨å’¨è¯¢ï¼šç”¨æˆ·è¯¢é—®å¦‚ä½•ä½¿ç”¨ã€åŠŸèƒ½åœ¨å“ªã€æ“ä½œæ–¹æ³•
- é—®é¢˜åé¦ˆï¼šç”¨æˆ·åé¦ˆBugã€å¼‚å¸¸ã€æ•…éšœã€æŠ¥é”™ã€æ— æ³•ä½¿ç”¨
- äº§å“éœ€æ±‚ï¼šç”¨æˆ·æå‡ºæ–°åŠŸèƒ½ã€æ”¹è¿›å»ºè®®ã€å¸Œæœ›å¢åŠ 
- äº§å“ç¼ºé™·ï¼šç¡®è®¤çš„ç³»ç»ŸBugã€è®¾è®¡ç¼ºé™·ã€éœ€è¦ä¿®å¤
"""

# ============================================================
# 1. é—®é¢˜åˆ†ææç¤ºè¯ - ç”¨äºä¼šè¯åˆ†æï¼Œæå–é—®é¢˜ç°è±¡/å…³é”®å¥/è§£å†³æ–¹æ¡ˆ
# ============================================================

ISSUE_ANALYSIS_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¼ä¸šçº§ä¼šè¯åˆ†æåŠ©æ‰‹ã€‚è¯·å¯¹ä»¥ä¸‹å¯¹è¯è¿›è¡Œç»“æ„åŒ–åˆ†æï¼Œå¹¶è¾“å‡º JSON å­—æ®µã€‚

ã€è¾“å‡ºå­—æ®µè¯´æ˜ã€‘
- phenomenonï¼šé—®é¢˜ç°è±¡æ€»ç»“ï¼Œ1-2å¥è¯æè¿°å®¢æˆ·é‡åˆ°çš„é—®é¢˜
- key_sentenceï¼šå…³é”®åŸè¯ï¼Œç›´æ¥å¼•ç”¨å¯¹è¯ä¸­æœ€é‡è¦çš„ä¸€å¥
- similar_case_causeï¼šå†å²ç›¸ä¼¼æ¡ˆä¾‹çš„åŸå› ï¼ˆå¦‚æ— å†å²æ¡ˆä¾‹åˆ™å†™"æš‚æ— å†å²æ¡ˆä¾‹"ï¼‰
- similar_case_solutionï¼šå†å²ç›¸ä¼¼æ¡ˆä¾‹çš„è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æ— å†å²æ¡ˆä¾‹åˆ™å†™"æš‚æ— å†å²æ–¹æ¡ˆ"ï¼‰
- ai_solutionï¼šAIå»ºè®®çš„è§£å†³æ–¹æ³•ï¼Œå¿…é¡»ç»™å‡º1-3æ¡å…·ä½“å¯æ‰§è¡Œçš„å»ºè®®
- soothing_replyï¼šå®‰æŠšè¯æœ¯ï¼Œå¯ç›´æ¥å‘é€ç»™å®¢æˆ·çš„ç®€çŸ­å›å¤

ã€å¼ºåˆ¶è¾“å‡ºè§„åˆ™ - è¿åå°†å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‘
1. ai_solution ç»å¯¹ç¦æ­¢è¾“å‡ºä»¥ä¸‹ä»»ä½•å€¼ï¼š"-"ã€"æ— "ã€"æš‚æ— "ã€"æš‚æ— AIå»ºè®®"ã€""ã€null
2. soothing_reply ç»å¯¹ç¦æ­¢è¾“å‡ºä»¥ä¸‹ä»»ä½•å€¼ï¼š"-"ã€"æ— "ã€"æš‚æ— "ã€"æš‚æ— å»ºè®®å›å¤"ã€""ã€null
3. æ— è®ºå¯¹è¯å†…å®¹å¦‚ä½•ï¼Œai_solution å’Œ soothing_reply å¿…é¡»æœ‰å®é™…å†…å®¹
4. å¦‚æœæ— æ³•ä»å¯¹è¯ä¸­æå–å…·ä½“å»ºè®®ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹é»˜è®¤å€¼ï¼š
   - ai_solution é»˜è®¤å€¼ï¼š"1.è¯·æä¾›æ›´å¤šé—®é¢˜è¯¦æƒ…; 2.æ£€æŸ¥ç½‘ç»œå’Œè®¾å¤‡çŠ¶æ€; 3.å¦‚é—®é¢˜æŒç»­è¯·è”ç³»æŠ€æœ¯æ”¯æŒ"
   - soothing_reply é»˜è®¤å€¼ï¼š"æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¤„ç†ï¼Œå¦‚æœ‰è¿›å±•ä¼šåŠæ—¶é€šçŸ¥æ‚¨ã€‚"

ã€ai_solution åœºæ™¯åŒ–æ¨¡æ¿ - å¿…é¡»é€‰æ‹©ä¸€ä¸ªã€‘
- é—®é¢˜æœªè§£å†³ï¼š"1.æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸; 2.å°è¯•é‡å¯åº”ç”¨; 3.æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬"
- é—®é¢˜å·²è§£å†³ï¼š"1.æŒç»­å…³æ³¨æ˜¯å¦å¤ç°; 2.å¦‚å†æ¬¡å‡ºç°è¯·æä¾›å½•å±å’Œæ—¥å¿—; 3.å»ºè®®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬"
- ä¿¡æ¯ä¸è¶³ï¼š"1.è¯·å®¢æˆ·æä¾›æ›´è¯¦ç»†çš„é—®é¢˜æè¿°; 2.æ”¶é›†è®¾å¤‡ä¿¡æ¯å’Œç‰ˆæœ¬å·; 3.å°è¯•å¤ç°é—®é¢˜å¹¶å½•å±"
- æŠ€æœ¯é—®é¢˜ï¼š"1.æ’æŸ¥æ—¥å¿—ç¡®è®¤æ ¹å› ; 2.ä¿®å¤åé€šçŸ¥å®¢æˆ·éªŒè¯; 3.è®°å½•é—®é¢˜åˆ°çŸ¥è¯†åº“"

ã€soothing_reply ç¤ºä¾‹ - å¿…é¡»é€‰æ‹©ä¸€ä¸ªã€‘
- "éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸ä¾¿ï¼Œæˆ‘ä»¬æ­£åœ¨ç§¯ææ’æŸ¥ï¼Œè¯·ç¨å€™ã€‚"
- "æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¤„ç†ï¼Œå¦‚æœ‰è¿›å±•ä¼šåŠæ—¶é€šçŸ¥æ‚¨ã€‚"
- "æ”¶åˆ°ï¼Œæˆ‘ä»¬ä¼šæŒç»­è·Ÿè¿›è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä»»ä½•ç–‘é—®éšæ—¶è”ç³»ã€‚"

ã€æ­£ç¡®è¾“å‡ºç¤ºä¾‹ã€‘
```json
{{
  "phenomenon": "ç”¨æˆ·åé¦ˆAppåœ¨äº‘æœºä¸Šé¢‘ç¹ç™½å±ï¼Œé‡å¯åä»æ— æ³•æ­£å¸¸ä½¿ç”¨",
  "key_sentence": "æˆ‘è¿™è¾¹äº‘æœºä¸ŠAppä¸€ç›´ç™½å±ï¼Œé‡å¯äº†å¥½å‡ æ¬¡éƒ½æ²¡ç”¨",
  "similar_case_cause": "æš‚æ— å†å²æ¡ˆä¾‹",
  "similar_case_solution": "æš‚æ— å†å²æ–¹æ¡ˆ",
  "ai_solution": "1.æ£€æŸ¥äº‘æœºç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®š; 2.æ¸…é™¤Appç¼“å­˜åé‡æ–°å¯åŠ¨; 3.å°è¯•é‡è£…Appæˆ–è”ç³»æŠ€æœ¯æ”¯æŒ",
  "soothing_reply": "éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸ä¾¿ï¼Œæˆ‘ä»¬æ­£åœ¨ç§¯ææ’æŸ¥ç™½å±é—®é¢˜ï¼Œè¯·ç¨å€™ã€‚"
}}
```

ã€é”™è¯¯è¾“å‡ºç¤ºä¾‹ - ä»¥ä¸‹æ ¼å¼ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œç»å¯¹ç¦æ­¢ã€‘
```json
{{
  "ai_solution": "-",
  "soothing_reply": ""
}}
```
```json
{{
  "ai_solution": "æš‚æ— AIå»ºè®®",
  "soothing_reply": "æš‚æ— å»ºè®®å›å¤"
}}
```

ã€å¯¹è¯å†…å®¹ã€‘
{chat_context}

ã€å†å²ç›¸ä¼¼æ¡ˆä¾‹ã€‘
{similar_context}

ä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¾“å‡º:
{format_instructions}
"""


# ============================================================
# 2. é£é™©ç›‘æ§å“¨å…µæç¤ºè¯ - ç”¨äºå®æ—¶ç›‘æ§ï¼Œåˆ¤æ–­æ¶ˆæ¯æ˜¯å¦éœ€è¦å‘Šè­¦
# ============================================================

RISK_SENTINEL_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªå®æ—¶ç›‘æ§å“¨å…µã€‚åˆ†æå®¢æˆ·æ¶ˆæ¯å¹¶è¯„ä¼°é£é™©ç­‰çº§ï¼Œæå–ç®€çŸ­çš„é—®é¢˜æ‘˜è¦ã€‚

ã€å¾…åˆ†ææ¶ˆæ¯ã€‘
"{text}"

ã€è¾“å‡ºå­—æ®µã€‘
- is_alert: æ˜¯å¦éœ€è¦å‘Šè­¦ (true/false)
- risk_score: é£é™©è¯„åˆ† (0-100)
- reason: åˆ¤æ–­ä¾æ®ï¼ˆ10å­—ä»¥å†…ï¼‰
- phenomenon: é—®é¢˜ç°è±¡ï¼ˆå¿…é¡»30å­—ä»¥å†…ï¼Œåªæè¿°é—®é¢˜æœ¬èº«ï¼‰
- key_sentence: å…³é”®åŸè¯ï¼ˆä¸€å¥è¯ï¼Œä¸å¸¦@å’Œå¼•ç”¨æ ¼å¼ï¼‰

ã€é£é™©è¯„åˆ†æ ‡å‡†ã€‘
- 0-30åˆ†ï¼šæ™®é€šå’¨è¯¢ã€ç¡®è®¤å›å¤ã€ç®€å•é—®é¢˜
- 31-60åˆ†ï¼šä¸€èˆ¬é—®é¢˜åé¦ˆã€åŠŸèƒ½å¼‚å¸¸
- 61-100åˆ†ï¼šä¸¥é‡æ•…éšœã€ç³»ç»Ÿå´©æºƒã€ç”¨æˆ·æ„¤æ€’

ã€Few-shot ç¤ºä¾‹ - å¿…é¡»ä¸¥æ ¼å‚è€ƒã€‘

ç¤ºä¾‹1 - é«˜é£é™©æ•…éšœï¼š
è¾“å…¥ï¼š"è¿™ä¸ªå®ä¾‹ä¸€ç›´ç™½å±ï¼Œé‡å¯äº†å¥½å‡ æ¬¡éƒ½æ²¡ç”¨ï¼Œæ€¥æ­»äº†"
è¾“å‡ºï¼š{{"is_alert": true, "risk_score": 80, "reason": "ç™½å±æ•…éšœ", "phenomenon": "å®ä¾‹ç™½å±ï¼Œé‡å¯æ— æ•ˆ", "key_sentence": "ä¸€ç›´ç™½å±ï¼Œé‡å¯äº†å¥½å‡ æ¬¡éƒ½æ²¡ç”¨"}}

ç¤ºä¾‹2 - ä¸­é£é™©é—®é¢˜ï¼š
è¾“å…¥ï¼š"å¼€æœºé€Ÿåº¦å¥½æ…¢ï¼Œç­‰äº†ä¸€åˆ†å¤šé’Ÿ"
è¾“å‡ºï¼š{{"is_alert": false, "risk_score": 45, "reason": "æ€§èƒ½é—®é¢˜", "phenomenon": "å¼€æœºé€Ÿåº¦æ…¢", "key_sentence": "å¼€æœºé€Ÿåº¦å¥½æ…¢ï¼Œç­‰äº†ä¸€åˆ†å¤šé’Ÿ"}}

ç¤ºä¾‹3 - ä½é£é™©ç¡®è®¤ï¼š
è¾“å…¥ï¼š"å¥½çš„ï¼Œæ”¶åˆ°ï¼Œæˆ‘è¯•è¯•"
è¾“å‡ºï¼š{{"is_alert": false, "risk_score": 5, "reason": "ç¡®è®¤å›å¤", "phenomenon": "ç”¨æˆ·ç¡®è®¤æ”¶åˆ°", "key_sentence": "å¥½çš„ï¼Œæ”¶åˆ°"}}

ç¤ºä¾‹4 - æ“ä½œå¤±è´¥ï¼š
è¾“å…¥ï¼š"æ”¹æœºå±æ€§å¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ“ä½œè¶…æ—¶"
è¾“å‡ºï¼š{{"is_alert": true, "risk_score": 65, "reason": "æ“ä½œå¤±è´¥", "phenomenon": "æ”¹æœºå±æ€§å¤±è´¥ï¼Œæ“ä½œè¶…æ—¶", "key_sentence": "æ”¹æœºå±æ€§å¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ“ä½œè¶…æ—¶"}}

ç¤ºä¾‹5 - å¤šè®¾å¤‡é—®é¢˜ï¼ˆä¸è¦åœ¨è¾“å‡ºä¸­åŒ…å«è®¾å¤‡IDï¼‰ï¼š
è¾“å…¥ï¼š"ACN499353996165135 ACN499354348552195 è¿™å‡ ä¸ªå®ä¾‹éƒ½æœ‰é—®é¢˜"
è¾“å‡ºï¼š{{"is_alert": true, "risk_score": 70, "reason": "æ‰¹é‡æ•…éšœ", "phenomenon": "å¤šä¸ªå®ä¾‹å‡ºç°é—®é¢˜", "key_sentence": "è¿™å‡ ä¸ªå®ä¾‹éƒ½æœ‰é—®é¢˜"}}

ç¤ºä¾‹6 - è·å–å¼‚å¸¸ï¼š
è¾“å…¥ï¼š"è·å–å®ä¾‹å¼‚å¸¸äº†ï¼Œç³»ç»Ÿç”¨ä¸äº†"
è¾“å‡ºï¼š{{"is_alert": true, "risk_score": 75, "reason": "ç³»ç»Ÿå¼‚å¸¸", "phenomenon": "è·å–å®ä¾‹å¼‚å¸¸ï¼Œç³»ç»Ÿä¸å¯ç”¨", "key_sentence": "è·å–å®ä¾‹å¼‚å¸¸äº†ï¼Œç³»ç»Ÿç”¨ä¸äº†"}}

ã€ç¦æ­¢è¾“å‡ºã€‘
- phenomenon è¶…è¿‡30å­—
- key_sentence åŒ…å« @ç”¨æˆ·å æˆ–ã€Œxxxï¼šã€æ ¼å¼
- åŒ…å«è®¾å¤‡IDåŸæ–‡ï¼ˆACN/ATPå¼€å¤´çš„é•¿ä¸²ï¼‰

ä¸¥æ ¼è¾“å‡º JSON:
{format_instructions}
"""


# ============================================================
# 3. é—®é¢˜åˆ†ç±»æç¤ºè¯ - åŸºäº taxonomy å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œåˆ†ç±»ï¼ˆRAG å¢å¼ºç‰ˆï¼‰
# ============================================================

ISSUE_CLASSIFICATION_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§é—®é¢˜åˆ†ç±»å™¨ã€‚è¯·æ ¹æ® taxonomy å’Œå†å²ç›¸ä¼¼æ¡ˆä¾‹å¯¹è¾“å…¥æ–‡æœ¬åˆ†ç±»ã€‚

Taxonomy ç‰ˆæœ¬: {taxonomy_version}
ä¸€çº§åˆ†ç±»ä¸äºŒçº§åˆ†ç±»ï¼š
{taxonomy_tree}

å¯é€‰æ ‡ç­¾ï¼š
{labels}

ã€ä¸¥é‡åº¦ç­‰çº§è¯´æ˜ï¼ˆS4 æœ€ä¸¥é‡ï¼ŒS1 æœ€è½»ï¼‰ã€‘
- S4ï¼šç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨ã€æ•°æ®ä¸¢å¤±ã€å…¨é‡å´©æºƒï¼Œå½±å“å…¨éƒ¨ç”¨æˆ·
- S3ï¼šæ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨ã€ä¸¥é‡æ•…éšœï¼Œå½±å“å¤§éƒ¨åˆ†ç”¨æˆ·
- S2ï¼šé‡è¦åŠŸèƒ½å¼‚å¸¸ã€æ•…éšœæŠ¥é”™ï¼Œå½±å“éƒ¨åˆ†ç”¨æˆ·
- S1ï¼šä¸€èˆ¬é—®é¢˜æˆ–è½»å¾®å’¨è¯¢ï¼ˆé»˜è®¤å€¼ï¼‰
- S0ï¼šæ— é£é™©ï¼Œçº¯é—²èŠ

category_short ä¸ºä¸­æ–‡çŸ­æ ‡ç­¾ï¼ˆ2-6å­—ï¼‰ï¼Œç”¨æ¥ç»™äººå¿«é€Ÿçœ‹æ‡‚åˆ†ç±»ã€‚
å¯é€‰çŸ­æ ‡ç­¾å‚è€ƒï¼š
{short_labels}

ã€å†å²ç›¸ä¼¼æ¡ˆä¾‹çš„åˆ†ç±»å‚è€ƒã€‘
ä»¥ä¸‹æ˜¯ä¸å½“å‰é—®é¢˜ç›¸ä¼¼çš„å†å²æ¡ˆä¾‹åˆ†ç±»ï¼Œå¯ä½œä¸ºå‚è€ƒï¼ˆä½†ä¸å¿…å®Œå…¨ä¸€è‡´ï¼‰ï¼š
{historical_categories}

ã€åˆ†ç±»ç­–ç•¥ã€‘
1. ä¼˜å…ˆæ ¹æ®å½“å‰æ–‡æœ¬å†…å®¹è¿›è¡Œç‹¬ç«‹åˆ†ç±»
2. å¦‚æœæ–‡æœ¬å«ä¹‰æ¨¡ç³Šï¼Œå¯å‚è€ƒå†å²ç›¸ä¼¼æ¡ˆä¾‹çš„åˆ†ç±»
3. ä¸¥é‡åº¦è¯„ä¼°åº”åŸºäºé—®é¢˜çš„å®é™…å½±å“èŒƒå›´

ã€è¾“å…¥æ–‡æœ¬ã€‘
{text}

ä¸¥æ ¼è¾“å‡º JSON:
{format_instructions}
"""


# ============================================================
# 4. é—®é¢˜ç±»å‹åˆ†ç±»æç¤ºè¯ - åˆ¤æ–­é—®é¢˜å±äºå“ªç§ç±»å‹ï¼ˆå››é€‰ä¸€ï¼‰
# ============================================================

ISSUE_TYPE_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§é—®é¢˜åˆ†ç±»åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·åé¦ˆå†…å®¹ï¼Œåˆ¤æ–­é—®é¢˜ç±»å‹ã€‚

ã€ç”¨æˆ·åé¦ˆå†…å®¹ã€‘
{text}

ã€é—®é¢˜ç±»å‹é€‰é¡¹ - å¿…é¡»é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‘
- ä½¿ç”¨å’¨è¯¢ï¼šç”¨æˆ·è¯¢é—®å¦‚ä½•ä½¿ç”¨ã€åŠŸèƒ½åœ¨å“ªã€æ“ä½œæ–¹æ³•
- é—®é¢˜åé¦ˆï¼šç”¨æˆ·åé¦ˆBugã€å¼‚å¸¸ã€æ•…éšœã€æŠ¥é”™ã€æ— æ³•ä½¿ç”¨
- äº§å“éœ€æ±‚ï¼šç”¨æˆ·æå‡ºæ–°åŠŸèƒ½ã€æ”¹è¿›å»ºè®®ã€å¸Œæœ›å¢åŠ 
- äº§å“ç¼ºé™·ï¼šç¡®è®¤çš„ç³»ç»ŸBugã€è®¾è®¡ç¼ºé™·ã€éœ€è¦ä¿®å¤

ã€åˆ¤æ–­ä¾æ®ã€‘
- å«"æ€ä¹ˆ/å¦‚ä½•/åœ¨å“ª/æ“ä½œ/æ•™ç¨‹" â†’ ä½¿ç”¨å’¨è¯¢
- å«"æŠ¥é”™/å¼‚å¸¸/å´©æºƒ/ç™½å±/æ— æ³•/å¤±è´¥/å¡é¡¿" â†’ é—®é¢˜åé¦ˆ
- å«"å¸Œæœ›/å»ºè®®/èƒ½ä¸èƒ½/æœ€å¥½/å¢åŠ " â†’ äº§å“éœ€æ±‚
- æ˜ç¡®æ˜¯ç³»ç»ŸBug/ä»£ç é—®é¢˜/éœ€å¼€å‘ä¿®å¤ â†’ äº§å“ç¼ºé™·
- é»˜è®¤å€¼ï¼šé—®é¢˜åé¦ˆ

ç›´æ¥è¾“å‡ºé—®é¢˜ç±»å‹ï¼ˆå››é€‰ä¸€ï¼‰ï¼š
"""


# ============================================================
# 5. ä¼˜å…ˆçº§åˆ¤æ–­æç¤ºè¯ - åˆ¤æ–­å¤„ç†ä¼˜å…ˆçº§ï¼ˆå››é€‰ä¸€ï¼‰
# ============================================================

PRIORITY_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§é—®é¢˜ä¼˜å…ˆçº§è¯„ä¼°åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·åé¦ˆå†…å®¹ï¼Œåˆ¤æ–­å¤„ç†ä¼˜å…ˆçº§ã€‚

ã€ç”¨æˆ·åé¦ˆå†…å®¹ã€‘
{text}

ã€ä¼˜å…ˆçº§é€‰é¡¹ - å¿…é¡»é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‘
- éå¸¸ç´§æ€¥ï¼ˆçº¢è‰²ï¼‰ï¼šç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨ã€å½±å“å…¨éƒ¨ç”¨æˆ·ã€ç”¨æˆ·éå¸¸æ„¤æ€’ã€ä¸šåŠ¡é˜»å¡
- ç´§æ€¥ï¼ˆé»„è‰²ï¼‰ï¼šæ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ã€å½±å“å¤§éƒ¨åˆ†ç”¨æˆ·ã€ç”¨æˆ·ç„¦æ€¥å‚¬ä¿ƒ
- æ™®é€šï¼ˆè“è‰²ï¼‰ï¼šä¸€èˆ¬é—®é¢˜åé¦ˆã€åŠŸèƒ½å¼‚å¸¸ä½†å¯ç»•è¿‡ã€å½±å“éƒ¨åˆ†ç”¨æˆ·
- è¾ƒä½ï¼ˆç°è‰²ï¼‰ï¼šæ™®é€šå’¨è¯¢ã€å»ºè®®ç±»ã€å½±å“æå°ã€å·²è§£å†³çš„é—®é¢˜

ã€åˆ¤æ–­ä¾æ®ã€‘
- å‡ºç°"ç´§æ€¥/æ€¥/é©¬ä¸Š/ç«‹åˆ»/å…¨éƒ¨/æ‰€æœ‰/å´©æºƒ/å®Œå…¨ä¸èƒ½ç”¨" â†’ éå¸¸ç´§æ€¥
- å‡ºç°"å°½å¿«/å½±å“ä½¿ç”¨/æŠ¥é”™/æ— æ³•æ­£å¸¸" â†’ ç´§æ€¥
- å‡ºç°"é—®é¢˜/å¼‚å¸¸/åé¦ˆ/å»ºè®®" â†’ æ™®é€š
- å‡ºç°"å’¨è¯¢/è¯·é—®/æ€ä¹ˆ/å¥½çš„/æ”¶åˆ°" â†’ è¾ƒä½
- é»˜è®¤å€¼ï¼šæ™®é€š

ç›´æ¥è¾“å‡ºä¼˜å…ˆçº§ï¼ˆå››é€‰ä¸€ï¼šè¾ƒä½/æ™®é€š/ç´§æ€¥/éå¸¸ç´§æ€¥ï¼‰ï¼š
"""


# ============================================================
# 6. é—®é¢˜æ¦‚æ‹¬æç¤ºè¯ - ç”Ÿæˆé—®é¢˜ç°è±¡æè¿°ï¼ˆ30å­—ä»¥å†…ï¼‰
# ============================================================

PHENOMENON_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§é—®é¢˜åˆ†æåŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œæç‚¼æ ¸å¿ƒé—®é¢˜ç°è±¡ã€‚

ã€ç”¨æˆ·åé¦ˆå†…å®¹ã€‘
{text}

ã€è¾“å‡ºè¦æ±‚ã€‘
- ä¸¥æ ¼30å­—ä»¥å†…
- åªæè¿°é—®é¢˜æœ¬èº«ï¼ˆå¦‚ï¼šå…³æœºå¤±è´¥ã€é—ªå±ã€ä»£ç†è®¾ç½®å¤±è´¥ï¼‰
- å¤šä¸ªé—®é¢˜ç”¨é¡¿å·è¿æ¥
- ç¦æ­¢åŒ…å«ï¼šç”¨æˆ·å§“åã€ç¾¤èŠåç§°ã€@æåŠã€è®¾å¤‡ID

ã€ç¤ºä¾‹ã€‘
- è¾“å…¥ï¼š"ACN123456789è¿™å°å…³æœºå¤±è´¥äº†ï¼Œè¿˜æœ‰é‚£å°ä¹Ÿé—ªå±"
  è¾“å‡ºï¼šå…³æœºå¤±è´¥ã€é—ªå±
- è¾“å…¥ï¼š"@å°æ˜ è®¾ç½®ä»£ç†å¤±è´¥ï¼Œè€Œä¸”å¼€æœºå¾ˆæ…¢"
  è¾“å‡ºï¼šä»£ç†è®¾ç½®å¤±è´¥ã€å¼€æœºç¼“æ…¢

ç›´æ¥è¾“å‡ºé—®é¢˜æ¦‚æ‹¬ï¼š
"""


# ============================================================
# 7. æ€»ç»“ç”Ÿæˆæç¤ºè¯ - ç”Ÿæˆé—®é¢˜æ€»ç»“ï¼ˆ50å­—å·¦å³ï¼‰
# ============================================================

SUMMARY_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§é—®é¢˜æ€»ç»“åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·åé¦ˆçš„å®Œæ•´å¯¹è¯å†…å®¹ï¼Œç”Ÿæˆè¯¦ç»†çš„é—®é¢˜æ€»ç»“ã€‚

ã€ç”¨æˆ·åé¦ˆå†…å®¹ã€‘
{text}

ã€è¾“å‡ºè¦æ±‚ã€‘
- å¿…é¡»50å­—å·¦å³ï¼ˆ45-60å­—ï¼‰
- å®Œæ•´æè¿°é—®é¢˜ï¼šåŒ…å«é—®é¢˜ç°è±¡ + å½±å“èŒƒå›´ + ç”¨æˆ·è¯‰æ±‚
- ç”¨å®¢è§‚ç¬¬ä¸‰äººç§°æè¿°ï¼ˆå¦‚"ç”¨æˆ·åé¦ˆ..."ã€"å®¢æˆ·é‡åˆ°..."ï¼‰
- ç¦æ­¢åŒ…å«ï¼šç”¨æˆ·å§“åã€ç¾¤èŠåç§°ã€@æåŠ
- å¯ä»¥ç®€åŒ–è®¾å¤‡IDä¸º"è¿™å°/é‚£å°/å¤šå°è®¾å¤‡"

ã€ç¤ºä¾‹ã€‘
- è¾“å…¥ï¼š"æˆ‘çš„ipæ˜¯é€šçš„ ä½†æ˜¯è·å–ä¸åˆ°å‡ºå£ipä¿¡æ¯ æ— æ³•ä½¿ç”¨æ™ºèƒ½ipåŠŸèƒ½"
  è¾“å‡ºï¼šç”¨æˆ·åé¦ˆæœ¬åœ°IPè¿é€šæ­£å¸¸ï¼Œä½†ç³»ç»Ÿæ— æ³•è·å–å‡ºå£IPä¿¡æ¯ï¼Œå¯¼è‡´æ™ºèƒ½IPåŠŸèƒ½å®Œå…¨ä¸å¯ç”¨ï¼Œå½±å“æ­£å¸¸ä¸šåŠ¡ä½¿ç”¨

- è¾“å…¥ï¼š"ACN123 å…³æœºå¤±è´¥äº†ï¼ŒACN456è¿™å°ä¹Ÿæ˜¯è¿˜é—ªå±ï¼Œè¿˜æœ‰è®¾ç½®ä»£ç†å¾ˆå¤šå¤±è´¥çš„"
  è¾“å‡ºï¼šç”¨æˆ·åé¦ˆå¤šå°è®¾å¤‡å‡ºç°å…³æœºå¤±è´¥å’Œé—ªå±é—®é¢˜ï¼ŒåŒæ—¶æ‰¹é‡è®¾ç½®ä»£ç†æ“ä½œå¤±è´¥ç‡è¾ƒé«˜ï¼Œå½±å“è®¾å¤‡æ­£å¸¸ç®¡ç†

ç›´æ¥è¾“å‡ºæ€»ç»“ï¼š
"""


# ============================================================
# 8. ç‰ˆæœ¬ä¸é•œåƒIDæå–æç¤ºè¯ - æå–æŠ€æœ¯ä¿¡æ¯
# ============================================================

VERSION_EXTRACTION_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§ä¿¡æ¯æŠ½å–åŠ©æ‰‹ã€‚è¯·ä»èŠå¤©å†…å®¹ä¸­æå–ä»¥ä¸‹å­—æ®µï¼Œå¹¶ä¸¥æ ¼è¾“å‡ºJSONã€‚

ã€èŠå¤©å†…å®¹ã€‘
{text}

ã€å­—æ®µè¦æ±‚ã€‘
- client_versionï¼šåªè¾“å‡ºå®¢æˆ·ç«¯ç‰ˆæœ¬å·ï¼ˆå¦‚ 1.2.3 / v20251211ï¼‰ï¼Œæ²¡æœ‰å°±è¾“å‡º "-"
- cbs_versionï¼šåªè¾“å‡ºCBSç‰ˆæœ¬å·ï¼ˆå¦‚ 20251211_12ï¼‰ï¼Œæ²¡æœ‰å°±è¾“å‡º "-"
- image_idï¼šåªè¾“å‡ºé•œåƒIDï¼ˆå¦‚ img-25121161049ï¼‰ï¼Œæ²¡æœ‰å°±è¾“å‡º "-"
- ç¦æ­¢åŒ…å«äººåã€ç¾¤èŠåã€@ã€ä»¥åŠå¤§æ®µåŸæ–‡

ã€è¯†åˆ«è§„åˆ™ã€‘
- å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼šé€šå¸¸å‡ºç°åœ¨"ç‰ˆæœ¬å·"ã€"å®¢æˆ·ç«¯"ã€"APPç‰ˆæœ¬"é™„è¿‘
- CBSç‰ˆæœ¬ï¼šé€šå¸¸å‡ºç°åœ¨"CBS"ã€"åç«¯ç‰ˆæœ¬"é™„è¿‘ï¼Œæ ¼å¼ä¸ºæ—¥æœŸ_åºå·
- é•œåƒIDï¼šé€šå¸¸ä»¥"img-"å¼€å¤´ï¼Œæˆ–å‡ºç°åœ¨"é•œåƒ"ã€"é•œåƒID"é™„è¿‘

ã€è¾“å‡ºJSONæ ¼å¼ã€‘
{{"client_version":"1.2.3","cbs_version":"20251211_12","image_id":"img-25121161049"}}

ä¸¥æ ¼è¾“å‡ºJSONï¼š
"""


# ============================================================
# 9. å®Œæ•´åˆ†ææç¤ºè¯ï¼ˆSentinelï¼‰- ä¸€æ¬¡æ€§è¾“å‡ºæ‰€æœ‰å­—æ®µ
# ============================================================

COMPLETE_ANALYSIS_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§å®¢æˆ·åé¦ˆåˆ†æåŠ©æ‰‹ã€‚åˆ†æç”¨æˆ·åé¦ˆå†…å®¹ï¼Œè¾“å‡ºç»“æ„åŒ–JSONã€‚

ã€ç”¨æˆ·åé¦ˆå†…å®¹ã€‘
{text}

ã€è¾“å‡ºå­—æ®µè¯´æ˜ã€‘
- issue_type: é—®é¢˜ç±»å‹ï¼ˆä½¿ç”¨å’¨è¯¢/é—®é¢˜åé¦ˆ/äº§å“éœ€æ±‚/äº§å“ç¼ºé™·ï¼Œå››é€‰ä¸€ï¼‰
- priority: ä¼˜å…ˆçº§ï¼ˆè¾ƒä½/æ™®é€š/ç´§æ€¥/éå¸¸ç´§æ€¥ï¼Œå››é€‰ä¸€ï¼‰
- phenomenon: é—®é¢˜æ¦‚æ‹¬ï¼ˆ30å­—ä»¥å†…ï¼Œåªæè¿°é—®é¢˜æœ¬èº«ã€‚å¦‚æœ‰å¤šä¸ªé—®é¢˜ç”¨é¡¿å·è¿æ¥ï¼‰
- summary: é—®é¢˜æ€»ç»“ï¼ˆ50å­—å·¦å³ï¼Œå®Œæ•´æè¿°é—®é¢˜ç°è±¡ã€å½±å“èŒƒå›´å’Œç”¨æˆ·è¯‰æ±‚ï¼‰
- problem_quote: é—®é¢˜åŸæ–‡å…³é”®å¥ï¼ˆå¿…å¡«ï¼ä»åŸæ–‡ä¸­ç²¾ç¡®æ‘˜å½•æœ€èƒ½åæ˜ é—®é¢˜çš„é‚£å¥è¯ï¼Œç”¨äºå®šä½é—®é¢˜å‘ç”Ÿä½ç½®ï¼Œ15-40å­—ï¼‰
- first_problem_quote: é—®é¢˜è®¨è®ºå¼€å§‹çš„åŸæ–‡ï¼ˆå¿…å¡«ï¼ç”¨æˆ·é¦–æ¬¡æè¿°é—®é¢˜çš„é‚£å¥è¯ï¼Œç”¨äºç¡®å®šæ—¶é—´èŒƒå›´èµ·ç‚¹ï¼Œ10-30å­—ï¼‰
- last_discussion_quote: é—®é¢˜è®¨è®ºç»“æŸçš„åŸæ–‡ï¼ˆå¿…å¡«ï¼é—®é¢˜è®¨è®ºç»“æŸæ—¶çš„é‚£å¥è¯ï¼Œé€šå¸¸æ˜¯è§£å†³ç¡®è®¤/å‘ŠçŸ¥åç»­ç­‰ï¼Œç”¨äºç¡®å®šæ—¶é—´èŒƒå›´ç»ˆç‚¹ï¼Œ10-30å­—ï¼‰
- platform: ç«¯å£åˆ†ç±»ï¼ˆCBS/å®¢æˆ·ç«¯/ROM/ç§»åŠ¨ç«¯/å…¶ä»–ï¼Œäº”é€‰ä¸€ï¼‰
- client_version: å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼ˆæ²¡æœ‰å°±è¾“å‡º"-"ï¼‰
- cbs_version: CBSç‰ˆæœ¬ï¼ˆæ²¡æœ‰å°±è¾“å‡º"-"ï¼‰
- image_id: é•œåƒIDï¼ˆæ²¡æœ‰å°±è¾“å‡º"-"ï¼‰

ã€åˆ¤æ–­è§„åˆ™ã€‘

é—®é¢˜ç±»å‹ï¼š
- å«"æ€ä¹ˆ/å¦‚ä½•/åœ¨å“ª/æ“ä½œ" â†’ ä½¿ç”¨å’¨è¯¢
- å«"æŠ¥é”™/å¼‚å¸¸/å´©æºƒ/ç™½å±/æ— æ³•/å¤±è´¥" â†’ é—®é¢˜åé¦ˆ
- å«"å¸Œæœ›/å»ºè®®/èƒ½ä¸èƒ½/æœ€å¥½" â†’ äº§å“éœ€æ±‚
- æ˜ç¡®æ˜¯ç³»ç»ŸBugéœ€ä¿®å¤ â†’ äº§å“ç¼ºé™·
- é»˜è®¤ï¼šé—®é¢˜åé¦ˆ

ä¼˜å…ˆçº§ï¼š
- å‡ºç°"ç´§æ€¥/æ€¥/é©¬ä¸Š/å…¨éƒ¨/å´©æºƒ/å®Œå…¨ä¸èƒ½ç”¨" â†’ éå¸¸ç´§æ€¥
- å‡ºç°"å°½å¿«/å½±å“ä½¿ç”¨/æŠ¥é”™/æ— æ³•æ­£å¸¸" â†’ ç´§æ€¥
- å‡ºç°"é—®é¢˜/å¼‚å¸¸/åé¦ˆ" â†’ æ™®é€š
- å‡ºç°"å’¨è¯¢/è¯·é—®/æ€ä¹ˆ/å¥½çš„/æ”¶åˆ°" â†’ è¾ƒä½
- é»˜è®¤ï¼šæ™®é€š

ç«¯å£åˆ†ç±»ï¼ˆplatformï¼‰ï¼š
- CBSï¼šå«"cbs/æœåŠ¡ç«¯/åç«¯/ç½‘å…³/é‰´æƒ/ç™»å½•æ€/token/ç­¾å/å›è°ƒ/è¶…æ—¶/500/502/503/é™æµ/è®¢å•/è®¡è´¹/æ•°æ®åº“"
- å®¢æˆ·ç«¯ï¼šå«"PC/Windows/macOS/æ¡Œé¢ç«¯/å®¢æˆ·ç«¯/å®‰è£…åŒ…/å¯åŠ¨/å´©æºƒ/ç™½å±/é©±åŠ¨/æ˜¾å¡/å¿«æ·é”®"
- ROMï¼šå«"ROM/å›ºä»¶/é•œåƒ/åˆ·æœº/ç³»ç»Ÿç‰ˆæœ¬/Androidç‰ˆæœ¬/å‡çº§/è¡¥ä¸/å†…æ ¸/root/GMS/Magisk/ç³»ç»Ÿå‡çº§"
- ç§»åŠ¨ç«¯ï¼šå«"iOS/APP/æ‰‹æœºç«¯/å°ç¨‹åº/åä¸º/å°ç±³/OPPO/vivo/TestFlight/åº”ç”¨å•†åº—"
- å…¶ä»–ï¼šæ— æ³•æ˜ç¡®å½’ç±»
- é»˜è®¤ï¼šå…¶ä»–

problem_quoteæå–è§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼ï¼‰ï¼š
- å¿…é¡»ä»åŸæ–‡ä¸­ç²¾ç¡®æ‘˜å½•ï¼Œä¸èƒ½æ”¹å†™æˆ–æ€»ç»“
- é€‰æ‹©æœ€èƒ½ä½“ç°é—®é¢˜çš„é‚£å¥è¯ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·é¦–æ¬¡æè¿°é—®é¢˜çš„é‚£å¥ï¼‰
- å¦‚æœæœ‰å¤šä¸ªé—®é¢˜ï¼Œé€‰æ‹©æœ€æ ¸å¿ƒ/æœ€ä¸¥é‡çš„é‚£ä¸ªé—®é¢˜çš„åŸæ–‡
- ä¸è¦åŒ…å«@æåŠã€å›å¤å¼•ç”¨æ ¼å¼

first_problem_quoteå’Œlast_discussion_quoteæå–è§„åˆ™ï¼ˆç”¨äºç¡®å®šå¯¹è¯æ—¶é—´èŒƒå›´ï¼‰ï¼š
- first_problem_quoteï¼šç”¨æˆ·é¦–æ¬¡æå‡º/æè¿°é—®é¢˜çš„åŸæ–‡ï¼ˆé€šå¸¸åœ¨å¯¹è¯å¼€å¤´ï¼‰
- last_discussion_quoteï¼šé—®é¢˜è®¨è®ºç»“æŸæ—¶çš„åŸæ–‡ï¼Œé€‰æ‹©ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š
  * é—®é¢˜å·²è§£å†³çš„ç¡®è®¤ï¼ˆå¦‚"å¥½äº†"ã€"å¯ä»¥äº†"ã€"æ²¡é—®é¢˜äº†"ï¼‰
  * æŠ€æœ¯äººå‘˜ç»™å‡ºçš„æœ€ç»ˆå›å¤/åç»­è®¡åˆ’
  * å¦‚æœå¯¹è¯æœªç»“æŸï¼Œé€‰æ‹©æœ€åä¸€æ¡ä¸é—®é¢˜ç›¸å…³çš„æ¶ˆæ¯
- å¿…é¡»ä»åŸæ–‡ç²¾ç¡®æ‘˜å½•ï¼Œç”¨äºåŒ¹é…æ¶ˆæ¯ç¡®å®šæ—¶é—´çª—å£

ã€ç¦æ­¢è¾“å‡ºã€‘
- phenomenon/summary åŒ…å«ç”¨æˆ·å§“åã€ç¾¤èŠåç§°ã€@æåŠ
- åŒ…å«å®Œæ•´è®¾å¤‡IDï¼ˆACN/ATPå¼€å¤´çš„é•¿ä¸²ï¼‰
- è¶…è¿‡å­—æ•°é™åˆ¶

ã€Few-shot ç¤ºä¾‹ã€‘

ç¤ºä¾‹1ï¼ˆå•æ¡æ¶ˆæ¯ï¼‰ï¼š
è¾“å…¥ï¼š"ACN123456789è¿™å°å…³æœºå¤±è´¥äº†ï¼ŒACN987654321è¿™å°ä¹Ÿæ˜¯è¿˜é—ªå±ï¼Œè¿˜æœ‰è®¾ç½®ä»£ç†å¾ˆå¤šå¤±è´¥çš„"
è¾“å‡ºï¼š{{"issue_type":"é—®é¢˜åé¦ˆ","priority":"ç´§æ€¥","phenomenon":"å…³æœºå¤±è´¥ã€é—ªå±ã€ä»£ç†è®¾ç½®å¤±è´¥","summary":"ç”¨æˆ·åé¦ˆå¤šå°è®¾å¤‡å‡ºç°å…³æœºå¤±è´¥å’Œé—ªå±é—®é¢˜ï¼ŒåŒæ—¶æ‰¹é‡è®¾ç½®ä»£ç†æ“ä½œå¤±è´¥ç‡è¾ƒé«˜ï¼Œå½±å“è®¾å¤‡æ­£å¸¸ç®¡ç†","problem_quote":"è¿™å°å…³æœºå¤±è´¥äº†ï¼Œè¿™å°ä¹Ÿæ˜¯è¿˜é—ªå±","first_problem_quote":"è¿™å°å…³æœºå¤±è´¥äº†","last_discussion_quote":"è¿˜æœ‰è®¾ç½®ä»£ç†å¾ˆå¤šå¤±è´¥çš„","platform":"å…¶ä»–","client_version":"-","cbs_version":"-","image_id":"-"}}

ç¤ºä¾‹2ï¼ˆå¤šè½®å¯¹è¯åœºæ™¯ï¼‰ï¼š
è¾“å…¥ï¼š"è¿™ä¸ªå¥½åƒæ˜¯å»¶è¿Ÿäº†ï¼Œä½ æ˜¯åœ¨åˆ›å»ºæ–°æœºçš„æ—¶å€™å‡ºç°çš„æŠ¥é”™?\næ˜¯çš„\nè¿™ä¸ªå±äºä»€ä¹ˆæƒ…å†µ?\næ˜¯è·¯ç”±å™¨çš„æ—¶é—´æ²¡åŒæ­¥ä¸Šå—?\nä¹Ÿå¯èƒ½æ˜¯ç½‘ç»œçŸ­æš‚å»¶è¿Ÿå¯¼è‡´çš„ã€‚æ˜¯å¶ç°çš„æƒ…å†µè¿˜æ˜¯ä¸€ç›´åˆ›äº‘æœºå°±è¿™æ ·?\nç°åœ¨æ²¡äº†ã€‚\né‚£æˆ‘ä»¬è¿™è¾¹è¿è¡Œçœ‹çœ‹\nä¸€èˆ¬å¤§ç‰ˆæœ¬æ›´æ–°éƒ½ä¼šç¨³å®šç‚¹çš„\nå¥½çš„ è¾›è‹¦\nå—¯å—¯åº”è¯¥çš„"
è¾“å‡ºï¼š{{"issue_type":"é—®é¢˜åé¦ˆ","priority":"æ™®é€š","phenomenon":"åˆ›å»ºäº‘æœºæ—¶æŠ¥é”™ï¼Œå¶ç°å»¶è¿Ÿ","summary":"ç”¨æˆ·åé¦ˆåˆ›å»ºäº‘æœºæ—¶å‡ºç°æŠ¥é”™ï¼Œç–‘ä¼¼ç½‘ç»œå»¶è¿Ÿæˆ–æ—¶é—´ä¸åŒæ­¥å¯¼è‡´ï¼Œé—®é¢˜å¶å‘ä¸”å½“å‰å·²æ¢å¤ï¼Œéœ€æŒç»­è§‚å¯Ÿ","problem_quote":"è¿™ä¸ªå¥½åƒæ˜¯å»¶è¿Ÿäº†ï¼Œä½ æ˜¯åœ¨åˆ›å»ºæ–°æœºçš„æ—¶å€™å‡ºç°çš„æŠ¥é”™","first_problem_quote":"è¿™ä¸ªå¥½åƒæ˜¯å»¶è¿Ÿäº†ï¼Œä½ æ˜¯åœ¨åˆ›å»ºæ–°æœºçš„æ—¶å€™å‡ºç°çš„æŠ¥é”™","last_discussion_quote":"å—¯å—¯åº”è¯¥çš„","platform":"å…¶ä»–","client_version":"-","cbs_version":"-","image_id":"-"}}

ç¤ºä¾‹3ï¼š
è¾“å…¥ï¼š"æ¥å£è¿”å›500é”™è¯¯ï¼Œtokené‰´æƒå¤±è´¥ï¼ŒCBSç‰ˆæœ¬20251211_12\nå¥½çš„æˆ‘ä»¬æŸ¥ä¸€ä¸‹\nå·²ç»ä¿®å¤äº†\nOK"
è¾“å‡ºï¼š{{"issue_type":"é—®é¢˜åé¦ˆ","priority":"éå¸¸ç´§æ€¥","phenomenon":"æ¥å£500é”™è¯¯ï¼Œé‰´æƒå¤±è´¥","summary":"ç”¨æˆ·åé¦ˆåç«¯æ¥å£è¿”å›500é”™è¯¯ï¼Œtokené‰´æƒå¼‚å¸¸å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œé—®é¢˜å·²ä¿®å¤","problem_quote":"æ¥å£è¿”å›500é”™è¯¯ï¼Œtokené‰´æƒå¤±è´¥","first_problem_quote":"æ¥å£è¿”å›500é”™è¯¯ï¼Œtokené‰´æƒå¤±è´¥","last_discussion_quote":"OK","platform":"CBS","cbs_version":"20251211_12","client_version":"-","image_id":"-"}}

ä¸¥æ ¼è¾“å‡ºJSONï¼š
"""


# ============================================================
# 10. åŸå£°æ‘˜è¦æç¤ºè¯ - ç”¨äºTBå¤‡æ³¨ä¸­çš„åŸç”Ÿæ‘˜è¦
# ============================================================

NOTE_SUMMARY_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§é—®é¢˜æ‘˜è¦åŠ©æ‰‹ã€‚æ ¹æ®èŠå¤©å†…å®¹ï¼Œæå–å¹¶æ€»ç»“æ ¸å¿ƒé—®é¢˜ã€‚

ã€èŠå¤©å†…å®¹ã€‘
{text}

ã€è¦æ±‚ã€‘
- ä¸¥æ ¼30å­—ä»¥å†…
- åªæè¿°é—®é¢˜æœ¬èº«ï¼ˆå¦‚ï¼šç³»ç»Ÿå¡é¡¿ã€æ— æ³•ç™»å½•ã€æ•°æ®ä¸¢å¤±ï¼‰
- ç¦æ­¢åŒ…å«ï¼šè®¾å¤‡IDã€ç”¨æˆ·åã€JSONæ•°æ®ã€å¼•ç”¨æ ¼å¼ã€ç¾¤èŠåç§°
- å¦‚æœå†…å®¹æ— æ³•è¯†åˆ«é—®é¢˜ï¼Œè¾“å‡º"æš‚æ— æ˜ç¡®é—®é¢˜"

ã€ç¤ºä¾‹è¾“å‡ºã€‘
- å…³æœºå¤±è´¥ï¼Œè¿™å°ä¹Ÿæ˜¯è¿˜é—ªå±ï¼Œè¿˜æœ‰è®¾ç½®ä»£ç†å¾ˆå¤šå¤±è´¥çš„
- å¼€æœºé€Ÿåº¦å¼‚å¸¸ç¼“æ…¢ï¼Œç­‰å¾…è¶…è¿‡ä¸€åˆ†é’Ÿ
- æ”¹æœºå±æ€§æ“ä½œå¤±è´¥ï¼Œæ˜¾ç¤ºè¶…æ—¶

ç›´æ¥è¾“å‡ºé—®é¢˜æ‘˜è¦ï¼š
"""


# ============================================================
# 11. å·¥å•æ ‡é¢˜ç”Ÿæˆæç¤ºè¯ - ç”¨äºTBå·¥å•æ ‡é¢˜
# ============================================================

TICKET_TITLE_PROMPT = """
ä½ æ˜¯ä¼ä¸šçº§å·¥å•æ ‡é¢˜ç”ŸæˆåŠ©æ‰‹ã€‚æ ¹æ®é—®é¢˜ä¿¡æ¯ï¼Œç”Ÿæˆè¯¦ç»†çš„å·¥å•æ ‡é¢˜ã€‚

ã€é—®é¢˜ç°è±¡ã€‘{phenomenon}
ã€é—®é¢˜æ€»ç»“ã€‘{summary}

ã€æ ‡é¢˜è¦æ±‚ã€‘
- å­—æ•°æ§åˆ¶åœ¨30-40å­—
- å®Œæ•´æè¿°é—®é¢˜ï¼šåŒ…å«é—®é¢˜ç±»å‹ + å…·ä½“ç°è±¡ + å½±å“èŒƒå›´
- åªæè¿°é—®é¢˜æœ¬èº«ï¼Œä¸è¦å¸¦"ç”¨æˆ·åé¦ˆ"ã€"å®¢æˆ·åé¦ˆ"ç­‰å‰ç¼€
- ä¸è¦å¸¦è®¾å¤‡IDï¼ˆACN/ATPå¼€å¤´çš„é•¿ä¸²ï¼‰
- ä¸è¦åŒ…å«ç”¨æˆ·å§“åã€ç¾¤èŠåç§°ã€@æåŠ

ã€ç¤ºä¾‹ã€‘
- è¾“å…¥ï¼šç°è±¡="å…³æœºå¤±è´¥ã€é—ªå±"ï¼Œæ€»ç»“="å¤šå°è®¾å¤‡å‡ºç°å…³æœºå¤±è´¥å’Œé—ªå±é—®é¢˜ï¼Œå½±å“è®¾å¤‡æ­£å¸¸ç®¡ç†"
  è¾“å‡ºï¼šå¤šå°è®¾å¤‡å‡ºç°å…³æœºå¤±è´¥å’Œé—ªå±é—®é¢˜ï¼Œå½±å“æ‰¹é‡è®¾å¤‡ç®¡ç†å’Œè¿ç»´æ“ä½œ

- è¾“å…¥ï¼šç°è±¡="ä»£ç†è®¾ç½®å¤±è´¥"ï¼Œæ€»ç»“="æ‰¹é‡è®¾ç½®ä»£ç†æ“ä½œå¤±è´¥ç‡è¾ƒé«˜"
  è¾“å‡ºï¼šæ‰¹é‡ä»£ç†è®¾ç½®æ“ä½œå¤±è´¥ç‡é«˜ï¼Œå¤šæ¬¡é‡è¯•ä»æ— æ³•å®Œæˆé…ç½®ä»»åŠ¡

- è¾“å…¥ï¼šç°è±¡="äº‘æœºæ‰“ä¸å¼€ç”»é¢"ï¼Œæ€»ç»“="äº‘æœºå®ä¾‹æ— æ³•æ­£å¸¸æ˜¾ç¤ºç”»é¢ï¼Œå½±å“ä¸šåŠ¡ä½¿ç”¨"
  è¾“å‡ºï¼šäº‘æœºå®ä¾‹ç”»é¢æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œç”¨æˆ·æ— æ³•è¿›è¡Œè¿œç¨‹æ“ä½œå’Œä¸šåŠ¡å¤„ç†

ç›´æ¥è¾“å‡ºæ ‡é¢˜ï¼Œä¸è¦åŠ å¼•å·ï¼š
"""


# ============================================================
# 12. è½»é‡çº§é¢„åˆ¤æ–­æç¤ºè¯ - åˆ¤æ–­å¯¹è¯æ˜¯å¦åŒ…å«æœ‰æ•ˆé—®é¢˜ï¼ˆèŠ‚çœ tokensï¼‰
# ============================================================

PRE_JUDGE_PROMPT = """åˆ¤æ–­ä»¥ä¸‹å¯¹è¯æ˜¯å¦åŒ…å«éœ€è¦å¤„ç†çš„ç”¨æˆ·é—®é¢˜æˆ–åé¦ˆã€‚

ã€å¯¹è¯å†…å®¹ã€‘
{chat_context}

ã€åˆ¤æ–­æ ‡å‡†ã€‘
æœ‰æ•ˆé—®é¢˜ï¼ˆè¿”å› trueï¼‰ï¼š
- ç”¨æˆ·é‡åˆ°äº§å“bugã€åŠŸèƒ½å¼‚å¸¸ã€ç³»ç»ŸæŠ¥é”™
- ç”¨æˆ·æ— æ³•æ­£å¸¸ä½¿ç”¨æŸåŠŸèƒ½ã€æ“ä½œå¤±è´¥
- ç”¨æˆ·åé¦ˆå¡é¡¿ã€å´©æºƒã€ç™½å±ã€é—ªé€€
- ç”¨æˆ·å’¨è¯¢äº§å“ä½¿ç”¨æ–¹æ³•ã€å¯»æ±‚å¸®åŠ©
- ç”¨æˆ·æå‡ºäº§å“æ”¹è¿›å»ºè®®æˆ–æ–°åŠŸèƒ½éœ€æ±‚

æ— æ•ˆå†…å®¹ï¼ˆè¿”å› falseï¼‰ï¼š
- çº¯é—²èŠã€æ—¥å¸¸é—®å€™ï¼ˆæ—©ä¸Šå¥½ã€ä½ å¥½ï¼‰
- ç¡®è®¤å›å¤ï¼ˆå¥½çš„ã€æ”¶åˆ°ã€è°¢è°¢ã€çŸ¥é“äº†ï¼‰
- æ— å…³è®¨è®ºã€è¡¨æƒ…å›å¤ã€ç®€çŸ­åº”ç­”
- é—®é¢˜å·²è§£å†³çš„ç¡®è®¤ï¼ˆå¥½äº†ã€å¯ä»¥äº†ã€æ²¡é—®é¢˜äº†ï¼‰

ã€è¾“å‡ºæ ¼å¼ã€‘ä¸¥æ ¼åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ï¼š
{{"has_issue": true/false, "reason": "ç®€çŸ­åŸå› (10å­—å†…)"}}

ã€ç¤ºä¾‹ã€‘
å¯¹è¯ï¼š"å¥½çš„æ”¶åˆ°ï¼Œæˆ‘è¯•è¯•çœ‹"
è¾“å‡ºï¼š{{"has_issue": false, "reason": "ç¡®è®¤å›å¤"}}

å¯¹è¯ï¼š"è¿™ä¸ªå®ä¾‹ä¸€ç›´ç™½å±æ‰“ä¸å¼€"
è¾“å‡ºï¼š{{"has_issue": true, "reason": "åŠŸèƒ½å¼‚å¸¸"}}

å¯¹è¯ï¼š"æ—©ä¸Šå¥½å•Š"
è¾“å‡ºï¼š{{"has_issue": false, "reason": "æ—¥å¸¸é—®å€™"}}

å¯¹è¯ï¼š"è®¾ç½®ä»£ç†å¤±è´¥äº†ï¼Œä¸€ç›´æŠ¥é”™"
è¾“å‡ºï¼š{{"has_issue": true, "reason": "æ“ä½œå¤±è´¥"}}"""


def get_pre_judge_prompt() -> str:
    """è·å–è½»é‡çº§é¢„åˆ¤æ–­æç¤ºè¯"""
    return PRE_JUDGE_PROMPT


# ============================================================
# ä¼˜å…ˆçº§å¸¸é‡ä¸æ˜ å°„
# ============================================================

# ä¼˜å…ˆçº§å›¾æ ‡æ˜ å°„
PRIORITY_ICONS = {
    "éå¸¸ç´§æ€¥": "ğŸ”´",
    "ç´§æ€¥": "ğŸŸ¡",
    "æ™®é€š": "ğŸ”µ",
    "è¾ƒä½": "âšª",
}

# ä¼˜å…ˆçº§åˆ°TBä¼˜å…ˆçº§çš„æ˜ å°„
PRIORITY_TO_TB = {
    "éå¸¸ç´§æ€¥": "ç´§æ€¥",
    "ç´§æ€¥": "è¾ƒé«˜",
    "æ™®é€š": "æ™®é€š",
    "è¾ƒä½": "è¾ƒä½",
}

# æœ‰æ•ˆçš„é—®é¢˜ç±»å‹åˆ—è¡¨
VALID_ISSUE_TYPES = ["ä½¿ç”¨å’¨è¯¢", "é—®é¢˜åé¦ˆ", "äº§å“éœ€æ±‚", "äº§å“ç¼ºé™·"]

# æœ‰æ•ˆçš„ä¼˜å…ˆçº§åˆ—è¡¨
VALID_PRIORITIES = ["è¾ƒä½", "æ™®é€š", "ç´§æ€¥", "éå¸¸ç´§æ€¥"]


# ============================================================
# è¾…åŠ©å‡½æ•° - ç”¨äºåŠ¨æ€æ„å»ºæç¤ºè¯
# ============================================================

def get_issue_analysis_prompt() -> str:
    """è·å–é—®é¢˜åˆ†ææç¤ºè¯"""
    return ISSUE_ANALYSIS_PROMPT


def get_risk_sentinel_prompt() -> str:
    """è·å–é£é™©ç›‘æ§å“¨å…µæç¤ºè¯"""
    return RISK_SENTINEL_PROMPT


def get_issue_classification_prompt() -> str:
    """è·å–é—®é¢˜åˆ†ç±»æç¤ºè¯"""
    return ISSUE_CLASSIFICATION_PROMPT


def get_issue_type_prompt() -> str:
    """è·å–é—®é¢˜ç±»å‹åˆ†ç±»æç¤ºè¯"""
    return ISSUE_TYPE_PROMPT


def get_priority_prompt() -> str:
    """è·å–ä¼˜å…ˆçº§åˆ¤æ–­æç¤ºè¯"""
    return PRIORITY_PROMPT


def get_phenomenon_prompt() -> str:
    """è·å–é—®é¢˜æ¦‚æ‹¬æç¤ºè¯"""
    return PHENOMENON_PROMPT


def get_summary_prompt() -> str:
    """è·å–æ€»ç»“ç”Ÿæˆæç¤ºè¯"""
    return SUMMARY_PROMPT


def get_version_extraction_prompt() -> str:
    """è·å–ç‰ˆæœ¬æå–æç¤ºè¯"""
    return VERSION_EXTRACTION_PROMPT


def get_complete_analysis_prompt() -> str:
    """è·å–å®Œæ•´åˆ†ææç¤ºè¯ï¼ˆä¸€æ¬¡æ€§è¾“å‡ºæ‰€æœ‰å­—æ®µï¼‰"""
    return COMPLETE_ANALYSIS_PROMPT


def get_note_summary_prompt() -> str:
    """è·å–åŸå£°æ‘˜è¦æç¤ºè¯"""
    return NOTE_SUMMARY_PROMPT


def get_ticket_title_prompt() -> str:
    """è·å–å·¥å•æ ‡é¢˜ç”Ÿæˆæç¤ºè¯"""
    return TICKET_TITLE_PROMPT


def get_priority_icon(priority: str) -> str:
    """æ ¹æ®ä¼˜å…ˆçº§è·å–å¯¹åº”å›¾æ ‡"""
    return PRIORITY_ICONS.get(priority, "ğŸ”µ")


def normalize_priority(priority: str | None) -> str:
    """æ ‡å‡†åŒ–ä¼˜å…ˆçº§ï¼Œç¡®ä¿è¿”å›æœ‰æ•ˆå€¼"""
    if priority in VALID_PRIORITIES:
        return priority
    return "æ™®é€š"


def normalize_issue_type(issue_type: str | None) -> str:
    """æ ‡å‡†åŒ–é—®é¢˜ç±»å‹ï¼Œç¡®ä¿è¿”å›æœ‰æ•ˆå€¼"""
    if issue_type in VALID_ISSUE_TYPES:
        return issue_type
    return "é—®é¢˜åé¦ˆ"
